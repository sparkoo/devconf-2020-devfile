apiVersion: 1.0.0
metadata:
  name: devconf-demo
projects:
  - name: frontend
    source:
      location: 'https://github.com/gothinkster/react-redux-realworld-example-app'
      type: git
  - name: backend
    source:
      location: 'https://github.com/gothinkster/golang-gin-realworld-example-app.git'
      type: git
    clonePath: src/github.com/gothinkster/golang-gin-realworld-example-app.git
attributes:
  persistVolumes: 'false'
components:
  - type: chePlugin
    id: che-incubator/typescript/latest
    memoryLimit: 512Mi
  - type: chePlugin
    id: ms-vscode/go/latest
    memoryLimit: 512Mi
  - alias: golang-backend
    type: dockerimage
    image: 'quay.io/eclipse/che-golang-1.12:nightly'
    memoryLimit: 512Mi
    mountSources: true
    env:
      - name: GOPATH
        # replicate the GOPATH from the plugin
        value: /go:$(CHE_PROJECTS_ROOT)
      - name: GOCACHE
        # replicate the GOCACHE from the plugin, even though the cache is not shared
        # between the two
        value: /tmp/.cache
    endpoints:
      - name: web
        port: 8585
        attributes:
          discoverable: 'true'
          public: 'true'
  - alias: nodejs-frontend
    type: dockerimage
    image: 'quay.io/eclipse/che-nodejs8-centos:nightly'
    memoryLimit: 1Gi
    mountSources: true
    endpoints:
      - name: web
        port: 4100
commands:
  - name: setup backend
    actions:
      - workdir: '${CHE_PROJECTS_ROOT}/backend'
        type: exec
        component: golang-backend
        command: go get -u github.com/kardianos/govendor && go get -u github.com/pilu/fresh && go get -u golang.org/x/crypto/...
  - name: run backend
    actions:
      - workdir: '${CHE_PROJECTS_ROOT}/backend'
        type: exec
        command: govendor sync && govendor add +external && fresh
        component: golang-backend
  - name: run frontend
    actions:
      - workdir: '${CHE_PROJECTS_ROOT}/frontend'
        type: exec
        command: npm install && npm start
        component: nodejs-frontend
